# 장고에서 모델 이용하기
모델은 장고 프로젝트의 토대가 되는 부분이다. 깊은 고려 없이 성급하게 장고 모델을 작성하다 보면 어느 순간의 프로젝트가 막다른 길로 다가가고 있음을 경험하게 될 것이다.
새 모델을 추가하거나 기존 모델을 수정해야 할 때, 한 번 더 깊이 생각해 보고 프로젝트의 토대를 가능한 한 탄탄하고 안전하게 다질 수 있는 방향의 디자인을 고려해야 한다.

## 시작하기
### 모델이 너무 많으면 앱을 나눈다.
앱 하나에 모델이 스무 개 이상 있다면 앱이 너무 많은 일을 하고 있다는 증거다. 크기가 작은 앱으로 분리하는 것을 고려해야 할 것이다. 각 앱이 가진 모델수가 다섯개를 넘지 않는 게 좋다.

### 모델 상속에 주의하자
모델 상속은 장고에서는 상당히 까다로운 주제다. 장고는 세 가지 모델 상속 방법을 제공한다. 추상화 기초 클래스, 멀티테이블 상속, 프록시 모델 이다.
> 각각의 장단점은 책을 참고하자.

### 데이터베이스 마이그레이션
장고는 강력한 데이터베이스 마이그레이션 도구를 제공한다.
마이그레이션 팁
- 새로운 앱이나 모델이 생성되면 python manage.py makemigration로 migrations 를 실행!
- sqlmigrate 명령을 이용해 어떤 SQL문이 실행되는지도 확인하자.
- 자체적인 mirgations 스타일로 이루어지지 않은 외부 앱에 대해 마이그레이션을 처리할 때는 MIGRATIONS_MODULES 세팅을 이용한다.

> MIGRATIONS_MODULES 세팅이 뭐지??

- 생성되는 마이그레이션 개수가 너무 많아서 불편하다고 느낀다면 squashmigration를 한번 이용해보자!

마이그레이션의 배포와 관리는 다음과 같이 한다.
- 배포 전에 마이그레이션을 되돌릴 수 있는지 확인해 보자! 완벽한 복구가 아닌 적정 수준까지 되돌리기도 불가능하다면 규모가 큰 프로젝트에서는 버그 트래킹이나 배포시에 큰 문제가 될 수 있다.
- 테이블에 수백만 개의 데이터가 이미 존재한다면 운영 서버에서 실제로 마이그레이션을 실행하기 전에 스테이징 서버에서 비슷한 크기의 데이터에 대해 충분히 테스트한다. 운영 서버에서의 마이그레이션은 생각하는 것 보다 더 '많은' 시간이 걸린다
> 격하게 공감한다.
- MySQL을 이용한다면 다음과 같이 한다.
- - 이건 책을 참고 한다.

## 장고 모델 디자인
장고 모델 디자인은 장고에서 가장 어려운 주제 중 하나다.

### 정규화하기
데이터베이스 정규화에 익숙해져야 한다. 데이터베이스 정규화에 아직 익숙하지 않다면 장고의 모델을 효과적으로 다루기 위한 선수 지식으로 데이터베이스 정규화 부분을 미리 숙지하자.

장고 모델 디자인은 항상 정규화로부터 시작하자. 충분한 시간을 가지고 이미 모델에 포함된 데이터들이 중복되어 다시 다른 모델에 포함되지 않도록 신경써야 한다.
관계 필드들에 대해 제약을 느끼지 않아도 된다. 일단 미숙하게 비정규화하는 것부터 피해 주기 바란다. 바로 데이터의 형태와 틀에 대한 지각이 필요한 시점이다.

### 캐시와 비정규화
적절한 위치에서 캐시를 세팅하는 것은 모델을 비정규화할 때 발생하는 문제점들을 상당 부분 해결해 주기도 한다.

### 반드시 필요한 경우에만 비정규화를 하도록 하자
> 더이상 말이 필요한가

### 언제 널을 쓰고 언제 공백을 쓸 것인가
> 이것도 필요할때마다 책을 참고해서 익히자

### 언제 BinaryField를 이용할 것인가?
> 개인적으로 내린 결론은 파일 위치만 저장하고, 최대한 안쓰는 방식으로 가는 게 좋을 듯하다.

### 범용 관계 피하기
범용 관계(generic relations) 이용과 models.field.GenericForeignKey 이용에 우리는 부정적인 입장이다. 일반적으로 이 두 가지는 장점보다 단점이 더 많다. 프로젝트에서 이 두 가지가 빈번이 이용되고 있다면 머지 않아 큰 문제가 발생할 거라는 증거이기도 하다.
범용 관계란 한 테이블로부터 다른 테이블을 서로 제약 조건이 없는 외부키로 바인딩하는 것이다.
> 결론은 일단 쓰지 말자!

### PostgreSQL에만 존재하는 필드에 대해 언제 널을 쓰고 언제 공백을 쓸 것인가
책을 참고하자 

## 모델의 _meta API
장고가 1.8이 되기 전까진 모델의 _meta API는 공식적이지 않았고 다분히 의도적으로 문서화되어 있지 않아서 API가 공지 없이 변경되곤 했다. 장고에서 _meta의 원래 목적은 모델에 대한 부가적인 정보를 장고 내부적으로 이용하기 위해서 였다. 하지만 이제는 공식 API 문서에 들어가도 될만큼 유용한 도구로 자리를 잡고 있다.
대부분의 프로젝트에서는 _meta 기능까지는 필요 없다. 필요하다면 다음 과 같은 이유로 사용된다.
 - 모델 필드의 리스트를 가져올 때
 - 모델의 특정 필드의 클래스를 가져올 때
 - 앞으로의 장고 버전들에서 이러한 정보를 어떻게 가져오게 되었는지 확실하게 상수로 남기기를 원할 때
다음과 같은 상황에서 사용한다.
- 장고 모델의 자체 검사 도구
- 라이브러리를 이용해서 특별하게 커스터마이징된 자신만의 장고를 만들 때
- 장고의 모델 데이터를 조정하거나 변경할 수 있는 일종의 관리 도구를 제작할 때
- 시각화 또는 분석 라이브러리를 제작할 때. 예를 들어, 'foo'라는 단어로 시작하는 필드에 대한 분석 정보

## 모델 매니저
모델에 질의를 하게 되면 장고의 ORM을 통하게 된다. 이때 모델 매니저라는 데이터베이스와 연동하는 인터페이스를 호출하게 된다.
이 모델 매니저는 원하는 클래스들을 제어하기 위해 모델클래스의 모든 인스턴스 세트에 작동하게 된다. 장고는 각 모델 클래스에 대한 기본 모델 매니저를 제공하며 커스터마이징도 가능하다.

## 거대 모델 이해하기
> 요약 : 신의 객체를 만들지 말고 작게 쪼개도록 한다.
